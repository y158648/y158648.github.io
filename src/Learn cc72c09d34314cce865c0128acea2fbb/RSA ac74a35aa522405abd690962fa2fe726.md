# RSA

问题:

- 公钥和私钥的区别是什么? 那个用来加密? 那个用来解密? [https://www.zhihu.com/question/25912483](https://www.zhihu.com/question/25912483)
解密难度, 定义上的公私

加密算法分为两大类: **对称加密** 和 **非对称加密**. 对称加密就是加密方和解密方共用一个密钥, 解密方以逆加密的方式解密. 非对称加密就是私钥加密公钥解密或者公钥加密私钥解密. **RSA算法** 是常用的非对称加密算法.

# **1. 数论基础**

## **1.1 模运算**

即 *求余运算*. 若两个整数对同一个正整数进行模运算, 结果相同, 则称这两个数 **同余**.

> 同余（英语：Congruence modulo[1]，符号：≡）在数学中是指数论中的一种等价关系[2]。当两个整数除以同一个正整数，若得相同余数，则二整数同余。同余是抽象代数中的同余关系的原型[3]。最先引用同余的概念与“≡”符号者为德国数学家高斯。
> 

> 两个整数a, b 若它们除以正整数所得的余数相等，则称a, b对于模m同余
> 
> 
> 记 $a \equiv b\ (mod\ m)$
> 
> 读作a同余b模m，或者读作a与b关于模m同余。
> 
> 比如$26 \equiv 14\ (mod\ 12)$。
> 

## **1.2 互质关系**

> 互质（英文：coprime，符号：⊥，又称互素、relatively prime、mutually prime、co-prime）[1]。在数论中，如果两个或两个以上的整数的最大公约数是 1，则称它们为互质[2]。依此定义：
> 
> - 如果[数域](https://zh.wikipedia.org/wiki/%E6%95%B0%E5%9F%9F)是[正整数](https://zh.wikipedia.org/wiki/%E6%AD%A3%E6%95%B4%E6%95%B8) $\mathbb{N^+}$，那么 1 与所有正整数互素[[3]](https://zh.wikipedia.org/wiki/%E4%BA%92%E8%B3%AA#cite_note-3)。
> - 如果[数域](https://zh.wikipedia.org/wiki/%E6%95%B0%E5%9F%9F)是[整数](https://zh.wikipedia.org/wiki/%E6%95%B4%E6%95%B8) ，那么 1 和 -1 与所有整数互素[[4]](https://zh.wikipedia.org/wiki/%E4%BA%92%E8%B3%AA#cite_note-4)，而且它们是唯一与 0 互素的整数[[5]](https://zh.wikipedia.org/wiki/%E4%BA%92%E8%B3%AA#cite_note-5)。
> 
> 两个整数 a 与 b 互素，记为 a⊥b。
> 

比如，15和32没有公因子，所以它们是互质关系。这说明，不是质数也可以构成互质关系。

关于互质关系，不难得到以下结论：

- 任意两个质数构成互质关系，比如13和61。
- 一个数是质数，另一个数只要不是前者的倍数，两者就构成互质关系，比如3和10。
- 如果两个数之中，较大的那个数是质数，则两者构成互质关系，比如97和57。
- 1和任意一个自然数是都是互质关系，比如1和99。
- p是大于1的整数，则p和p-1构成互质关系，比如57和56。
- p是大于1的奇数，则p和p-2构成互质关系，比如17和15。

## **1.3 欧拉函数**

> 在数论中，对正整数n，欧拉函数是小于等于n的正整数中与n互质的数的数目。此函数以其首名研究者欧拉命名，它又称为φ函数（由高斯所命名）或是欧拉总计函数[1]（totient function，由西尔维斯特所命名）。
> 
> 
> 例如，因为1,3,5,7均和8互质。
> 

> 读作 phi[faɪ]
> 

### **1.3.1 第一种情况**

$$
\varphi(1)=1
$$

### **1.3.2 第二种情况**

n 为质数, 则 

$$
\varphi(n)=n-1
$$

### **1.3.3 第三种情况**

如果n是质数的某一个次方，即 n = p^k (p为质数，k为大于等于1的整数)，则

$$
\varphi(p^k)=p^k-p^{k-1}=p^k(1-{\frac1 p})
$$

因为, 小于等于p^k并且与p^k不互质的数一定小于p^k并且是p的倍数, 即 $p, 2p, 3p, ..., p^{k-1}p$, 共有 $p^{k-1}$ 个, 其余的都与p^k互质, 故得上述公式.

### **1.3.4 第四种情况**

如果n可以分解成两个互质的整数之积，即

$$
n = p \cdot q
$$

则

$$
\varphi(n)=\varphi(p \cdot q)=\varphi(p) \cdot \varphi(q)
$$

比如，。证明可见[Wiki-欧拉函数](https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0)

可以看出, 若p, q都是质数则 

### **1.3.5 第五种情况**

任意一个大于1的正整数，都可以写成一系列质数的积。

$$
n=p^{k1}_1p^{k2}_2 \cdot \cdot \cdot p^{kr}_r
$$

根据 1.3.4, 可得

$$
\varphi(n)=\varphi(p^{k1}_1)\varphi(p^{k1}_1) \cdot \cdot \cdot \varphi(p^{kr}_r)
$$

根据 1.3.3, 可得

$$
\varphi(n)=p^{k1}_1p^{k2}_2 \cdot \cdot \cdot p^{kr}_r \cdot (1-{\frac1 {p_1}})(1-{\frac1 {p_2}}) \cdot \cdot \cdot (1-{\frac r {p_r}})=n(1-{\frac1 {p_1}})(1-{\frac1 {p_2}}) \cdot \cdot \cdot (1-{\frac r {p_r}})
$$

比如，1323的欧拉函数，计算过程如下：

$$
\varphi(1323)=\varphi(3^3 \cdot 7^2)=1323(1-{\frac1 3})(1-{\frac1 7})=756
$$

## **1.4 欧拉定理**

> 在数论中，欧拉定理（也称费马-欧拉定理或欧拉$\varphi$函数定理）是一个关于同余的性质。欧拉定理表明，若为n, a正整数，且n, a互素（即gcd(n, a)=1)，则
> 
> 
> $$
> a^{\varphi(n)} \equiv 1\ (mod\ n)
> $$
> 

也就是说，a的$\varphi(n)$次方被n除的余数为1。或者说，a的$\varphi(n)$次方减去1，可以被n整除。比如，3和7互质，而7的欧拉函数$φ(7)$等于6，所以3的6次方即729减去1，可以被7整除(728/7=104)。

证明可见[Wiki-欧拉定理](https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86_(%E6%95%B0%E8%AE%BA))

欧拉定理可以大大简化某些运算。比如，7和10互质，根据欧拉定理，

$$
7^{\varphi(10)} \equiv 1\ (mod\ 10)
$$

可知 $7^4$ 以及 $7^{4k}$ (k为大于等于1的正整数)的个位数为1, 即

$$
7^4 \equiv 7^{4k} \equiv 1\ (mod\ 10)
$$

因此, 7的任意次方的个位数简单计算就能算出, 例如 $7^{222}=7^{220} \cdot 7^2$, 所以 $7^{222}$ 的个位数为 9

## **1.5 模反元素**

> 模反元素也称为模倒数，或者模逆元。
> 
> 
> 一[整数](https://zh.wikipedia.org/wiki/%E6%95%B4%E6%95%B0)a对[同余](https://zh.wikipedia.org/wiki/%E5%90%8C%E9%A4%98)n之**模逆元**是指满足以下公式的整数 b
> 
> $$
> a^{-1} \equiv b\ (mod\ n)
> $$
> 
> 也可以写成以下的式子
> 
> $$
> ab \equiv 1\ (mod\ n)
> $$
> 
> 或者
> 
> $$
> ab(mod\ n)=1
> $$
> 
> 整数 a 对模数 n 之模逆元存在的[充分必要条件](https://zh.wikipedia.org/wiki/%E5%85%85%E5%88%86%E5%BF%85%E8%A6%81%E6%A2%9D%E4%BB%B6)是 a 和 n [互素](https://zh.wikipedia.org/wiki/%E4%BA%92%E8%B3%AA)，若此模逆元存在，在模数 n 下的除法可以用和对应模逆元的乘法来达成，此概念和实数除法的概念相同。
> 

> 如果两个正整数a和n互质，那么一定可以找到整数b，使得 ab-1 被n整除，或者说ab被n除的余数是1。这时，b就叫做a的“模反元素”。
> 
> 
> 比如，3和11互质，那么3的模反元素就是4，因为 (3 × 4)-1 可以被11整除。显然，模反元素不止一个， 4加减11的整数倍都是3的模反元素 {…,-18,-7,4,15,26,…}，即如果b是a的模反元素，则 b+kn 都是a的模反元素。
> 

根据欧拉定理,

$$
a^{\varphi(n)}=a^{\varphi(n)-1} \cdot a \equiv 1\ (mod\ n)
$$

即 $a^{\varphi(n)-1}$ 是 a 的模反元素

# **2. RSA算法**

小红要和小明进行**加密通讯**, 并且要求生成一对公钥和私钥, 其中公钥加密, 私钥解密.

### **1. 随机选择两个不相等的质数p和q。**

小红选了61和53。（实际应用中，这两个质数越大，就越难破解。）

### **2. 计算p和q的乘积n。**

$$
n = 61×53 = 3233
$$

n的长度就是密钥长度。3233写成二进制是110010100001，一共有12位，所以这个密钥就是12位。实际应用中，RSA密钥一般是1024位，重要场合则为2048位。

### **3. 计算n的欧拉函数φ(n)。**

根据 1.3.4,

$$
\varphi(n)=(61-1)(53-1)=3120
$$

### **4. 随机选择一个整数e，条件是1< e < φ(n)，且e与φ(n)互质。**

小红就在1到3120之间，随机选择了17。（实际应用中，常常选择65537。）

### **5. 计算e对于φ(n)的模反元素d。**

即

$$
ed \equiv 1\ (mod\ \varphi(n))
$$

等价于

$$
ed-1=k\varphi(n)
$$

等价于

$$
ed+k\varphi(n)=1
$$

其中, e=17, φ(n)=3120, 即

$$
17d + 3120k = 1
$$

这个方程可以用[扩展欧几里得算法](https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95)求解，此处省略具体过程。总之，小红算出一组整数解为 (d,k)=(2753,-15)，即 d=2753。

至此所有计算完成。

### **6. 将n和e封装成公钥，n和d封装成私钥。**

在小红的例子中，n=3233，e=17，d=2753，所以公钥就是 (3233,17)，私钥就是（3233, 2753）。

实际应用中，公钥和私钥的数据都采用[ASN.1](https://zh.wikipedia.org/zh-cn/ASN.1)格式表达（[实例](https://hi.baidu.com/mathack/item/d0ad4cc1514a3663f7c95da2)）。

### **7. RAS算法的可靠性**

回顾上面的密钥生成步骤，一共出现六个数字：

$$
p\ \ q\ \ n\ \ φ(n)\ \ e\ \ d
$$